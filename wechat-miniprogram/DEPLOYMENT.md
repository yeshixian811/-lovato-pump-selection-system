# 微信小程序部署指南

## 📋 目录

- [快速开始](#快速开始)
- [导入项目](#导入项目)
- [配置开发环境](#配置开发环境)
- [测试和调试](#测试和调试)
- [发布上线](#发布上线)
- [常见问题](#常见问题)

---

## 🚀 快速开始

### 前置要求

1. **微信开发者工具**
   - 下载地址：https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html
   - 版本要求：最新稳定版

2. **微信小程序 AppID**
   - 注册地址：https://mp.weixin.qq.com/
   - 可以使用测试号进行开发

3. **Node.js**（可选，如需 npm 支持）
   - 版本要求：Node.js 20+
   - 下载地址：https://nodejs.org/

---

## 📥 导入项目

### 方法 1：直接导入（推荐）

#### 步骤 1：获取项目代码

**选项 A：从 GitHub 克隆**

```bash
# 克隆仓库
git clone https://github.com/你的用户名/lovato-pump.git

# 进入小程序目录
cd lovato-pump/wechat-miniprogram
```

**选项 B：下载压缩包**

1. 访问 GitHub 仓库
2. 点击 "Code" -> "Download ZIP"
3. 解压到本地
4. 进入 `wechat-miniprogram` 目录

#### 步骤 2：打开微信开发者工具

1. 启动微信开发者工具
2. 选择"导入项目"
3. 选择 `wechat-miniprogram` 目录
4. 配置项目信息：
   - **项目名称**：洛瓦托水泵选型系统
   - **AppID**：使用测试号或你的 AppID
   - **开发模式**：小程序
   - **后端服务**：不使用云服务
5. 点击"导入"

#### 步骤 3：项目配置

导入后，检查项目配置：

```json
// project.config.json
{
  "appid": "touristappid",  // 替换为你的 AppID
  "projectname": "lovato-pump-miniprogram",
  "libVersion": "2.19.4"
}
```

### 方法 2：使用 WinSCP 上传

如果你在火山云服务器上：

#### 步骤 1：打包项目

```bash
# 在服务器上
cd /workspace/projects/wechat-miniprogram
zip -r wechat-miniprogram.zip .
```

#### 步骤 2：下载到本地

1. 使用 WinSCP 连接服务器
2. 下载 `wechat-miniprogram.zip`
3. 解压到本地目录

#### 步骤 3：导入到微信开发者工具

同方法 1 的步骤 2-3

---

## ⚙️ 配置开发环境

### 1. 配置 API 地址

编辑 `utils/api.ts` 文件：

```typescript
// 生产环境
const BASE_URL = 'https://lowato-hvac.com/api'

// 测试环境（本地开发）
// const BASE_URL = 'http://localhost:5000/api'

// 火山云测试环境
// const BASE_URL = 'http://14.103.55.52:5000/api'
```

### 2. 配置 AppID

编辑 `project.config.json`：

```json
{
  "appid": "wxXXXXXXXXXXXXXXXX",  // 替换为你的 AppID
  "projectname": "lovato-pump-miniprogram"
}
```

### 3. 安装依赖（可选）

如果项目使用 npm 包：

```bash
# 在项目根目录下
npm install

# 或使用微信开发者工具
# 工具 -> 构建 npm
```

### 4. 配置项目设置

在微信开发者工具中：

1. 点击"详情" -> "本地设置"
2. 启用"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"（开发阶段）
3. 关闭"启用调试"（生产环境）

---

## 🧪 测试和调试

### 1. 编译项目

```bash
# 在微信开发者工具中
# 点击"编译"按钮
```

### 2. 模拟器测试

- 测试所有页面功能
- 测试性能曲线展示
- 测试 API 请求
- 测试收藏功能

### 3. 真机预览

```bash
# 在微信开发者工具中
# 点击"预览"按钮
# 使用微信扫码
# 在手机上测试
```

### 4. 真机调试

```bash
# 在微信开发者工具中
# 点击"真机调试"按钮
# 使用微信扫码
# 可以查看控制台日志
```

### 5. 性能监控

```bash
# 在微信开发者工具中
# 点击"性能"按钮
# 查看性能指标
# 优化性能瓶颈
```

---

## 🚢 发布上线

### 1. 版本号管理

在 `project.config.json` 中配置版本号：

```json
{
  "version": "1.0.0"
}
```

版本号格式：`主版本.次版本.修订号`

- **主版本**：重大更新，不兼容的 API 修改
- **次版本**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

### 2. 上传代码

```bash
# 在微信开发者工具中
# 点击"上传"按钮
# 填写版本号：1.0.0
# 填写备注：首次发布
# 点击"确定"
```

上传成功后，代码会同步到微信公众平台。

### 3. 提交审核

#### 登录微信公众平台

1. 访问 https://mp.weixin.qq.com/
2. 登录你的小程序账号
3. 进入"版本管理"

#### 填写审核信息

1. 点击"提交审核"
2. 填写审核表单：
   - **版本号**：1.0.0
   - **版本描述**：洛瓦托水泵选型系统，智能选型工具
   - **测试账号**：（可选）
   - **测试账号密码**：（可选）
3. 点击"提交"

#### 等待审核

- 审核时间：通常 1-7 个工作日
- 审核结果：会通过微信通知

### 4. 发布上线

审核通过后：

```bash
# 在微信公众平台上
# 点击"发布"按钮
# 确认发布信息
# 点击"确认发布"
```

发布成功后，用户可以在微信中搜索到你的小程序。

---

## ❓ 常见问题

### 1. 导入项目失败

**问题**：导入项目时报错"不是有效的项目目录"

**解决方案**：
- 确保选择了正确的目录（`wechat-miniprogram` 目录）
- 检查目录下是否有 `app.json` 和 `project.config.json` 文件
- 重新下载项目代码

### 2. API 请求失败

**问题**：所有 API 请求都失败

**解决方案**：
- 检查 API 地址是否正确
- 检查网络连接
- 开启"不校验合法域名"选项（开发阶段）
- 确保服务器正常运行

### 3. 性能曲线不显示

**问题**：产品详情页面看不到性能曲线

**解决方案**：
- 检查产品数据中是否有 `performance_curve` 数据
- 检查 ECharts 组件是否正确引入
- 查看控制台错误日志

### 4. 收藏功能失效

**问题**：点击收藏没有反应

**解决方案**：
- 检查 `app.ts` 中的收藏逻辑
- 检查本地存储是否可用
- 查看控制台错误日志

### 5. 真机预览失败

**问题**：点击"预览"没有反应

**解决方案**：
- 检查手机网络连接
- 确保微信版本最新
- 重新编译项目
- 重启微信开发者工具

### 6. 审核被拒

**问题**：提交审核后被拒绝

**解决方案**：
- 仔细阅读审核拒绝原因
- 修复问题后重新提交
- 联系微信客服咨询

常见拒绝原因：
- 功能不完整
- 内容违规
- 缺少必要的用户协议和隐私政策
- 类目选择不正确

---

## 📞 技术支持

如果遇到问题，请联系：

- **客服电话**：400-XXX-XXXX
- **电子邮箱**：support@lovato-pump.com
- **技术文档**：查看项目 README.md

---

## 📚 相关文档

- [微信小程序官方文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [微信开发者工具文档](https://developers.weixin.qq.com/miniprogram/dev/devtools/)
- [微信小程序 API 文档](https://developers.weixin.qq.com/miniprogram/dev/api/)
- [性能曲线说明](README.md#性能曲线说明)

---

## ✅ 部署检查清单

在发布上线前，请确保：

- [ ] 所有功能测试通过
- [ ] 性能曲线显示正常
- [ ] API 请求正常
- [ ] 收藏功能正常
- [ ] 分享功能正常
- [ ] 页面加载速度正常
- [ ] 无控制台错误
- [ ] 版本号正确
- [ ] 用户协议完整
- [ ] 隐私政策完整
- [ ] 类目选择正确
- [ ] 服务类目符合要求
- [ ] 已在真机上测试
- [ ] 已在多种设备上测试

---

## 🎯 下一步

部署完成后：

1. 监控小程序使用情况
2. 收集用户反馈
3. 优化性能和体验
4. 更新功能和内容
5. 发布新版本

---

祝部署顺利！🚀
