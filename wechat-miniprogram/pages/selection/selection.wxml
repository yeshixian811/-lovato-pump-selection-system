<!-- æ™ºèƒ½é€‰å‹é¡µé¢ -->

<scroll-view class="page-container" scroll-y="{{true}}">
  <!-- é€‰å‹è¡¨å• -->
  <view class="selection-form" wx:if="{{!showResult}}">
    <view class="form-header">
      <view class="form-title">æ™ºèƒ½é€‰å‹</view>
      <view class="form-desc">è¾“å…¥æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å°†ä¸ºæ‚¨æ¨èæœ€åˆé€‚çš„æ°´æ³µå‹å·</view>
    </view>

    <!-- æµé‡é€‰æ‹© -->
    <view class="form-section">
      <view class="section-label">
        <text class="label-text">æ‰€éœ€æµé‡</text>
        <text class="label-value">{{selectionParams.required_flow_rate}} mÂ³/h</text>
      </view>
      <slider
        class="form-slider"
        min="1"
        max="100"
        value="{{selectionParams.required_flow_rate}}"
        step="1"
        activeColor="#1e40af"
        backgroundColor="#e2e8f0"
        block-size="20"
        bindchange="onFlowSliderChange"
      />
      <view class="slider-tips">
        <text class="tip">1</text>
        <text class="tip">50</text>
        <text class="tip">100</text>
      </view>
    </view>

    <!-- æ‰¬ç¨‹é€‰æ‹© -->
    <view class="form-section">
      <view class="section-label">
        <text class="label-text">æ‰€éœ€æ‰¬ç¨‹</text>
        <text class="label-value">{{selectionParams.required_head}} m</text>
      </view>
      <slider
        class="form-slider"
        min="1"
        max="200"
        value="{{selectionParams.required_head}}"
        step="1"
        activeColor="#1e40af"
        backgroundColor="#e2e8f0"
        block-size="20"
        bindchange="onHeadSliderChange"
      />
      <view class="slider-tips">
        <text class="tip">1</text>
        <text class="tip">100</text>
        <text class="tip">200</text>
      </view>
    </view>

    <!-- åº”ç”¨åœºæ™¯ -->
    <view class="form-section">
      <view class="section-label">
        <text class="label-text">åº”ç”¨åœºæ™¯</text>
      </view>
      <picker
        mode="selector"
        range="{{applicationTypes}}"
        value="{{applicationTypes.indexOf(selectionParams.application_type)}}"
        bindchange="onApplicationTypeChange"
      >
        <view class="picker">
          <text class="picker-text">{{selectionParams.application_type}}</text>
          <text class="picker-arrow">â€º</text>
        </view>
      </picker>
    </view>

    <!-- æµä½“ç±»å‹ -->
    <view class="form-section">
      <view class="section-label">
        <text class="label-text">æµä½“ç±»å‹</text>
      </view>
      <picker
        mode="selector"
        range="{{fluidTypes}}"
        value="{{fluidTypes.indexOf(selectionParams.fluid_type)}}"
        bindchange="onFluidTypeChange"
      >
        <view class="picker">
          <text class="picker-text">{{selectionParams.fluid_type}}</text>
          <text class="picker-arrow">â€º</text>
        </view>
      </picker>
    </view>

    <!-- æ°´æ³µç±»å‹ -->
    <view class="form-section">
      <view class="section-label">
        <text class="label-text">æ°´æ³µç±»å‹</text>
      </view>
      <picker
        mode="selector"
        range="{{pumpTypes}}"
        value="{{pumpTypes.indexOf(selectionParams.pump_type)}}"
        bindchange="onPumpTypeChange"
      >
        <view class="picker">
          <text class="picker-text">{{selectionParams.pump_type}}</text>
          <text class="picker-arrow">â€º</text>
        </view>
      </picker>
    </view>

    <!-- æŒ‰é’® -->
    <view class="form-buttons">
      <button class="btn btn-outline" bindtap="onReset">é‡ç½®</button>
      <button class="btn btn-primary" bindtap="onSelection" loading="{{loading}}">
        {{loading ? 'é€‰å‹ä¸­...' : 'å¼€å§‹é€‰å‹'}}
      </button>
    </view>
  </view>

  <!-- é€‰å‹ç»“æœ -->
  <view class="selection-results" wx:if="{{showResult}}">
    <view class="results-header">
      <view class="header-left">
        <view class="header-title">é€‰å‹ç»“æœ</view>
        <view class="header-count">æ‰¾åˆ° {{results.length}} ä¸ªåŒ¹é…äº§å“</view>
      </view>
      <view class="header-right">
        <view class="result-summary">
          <text class="summary-label">éœ€æ±‚:</text>
          <text class="summary-value">{{selectionParams.required_flow_rate}} mÂ³/h, {{selectionParams.required_head}} m</text>
        </view>
      </view>
    </view>

    <!-- ç»“æœåˆ—è¡¨ -->
    <view class="results-list" wx:if="{{results.length > 0}}">
      <view
        class="result-card"
        wx:for="{{results}}"
        wx:key="id"
        bindtap="onProductDetail"
        data-id="{{item.id}}"
      >
        <view class="result-header">
          <view class="result-model">{{item.model}}</view>
          <view class="result-badge {{item.match_score >= 80 ? 'badge-success' : item.match_score >= 60 ? 'badge-warning' : 'badge-info'}}">
            åŒ¹é…åº¦ {{item.match_score}}%
          </view>
        </view>

        <view class="result-name">{{item.name}}</view>

        <view class="result-specs">
          <view class="spec-item">
            <text class="spec-label">æµé‡:</text>
            <text class="spec-value">{{item.max_flow_rate}} mÂ³/h</text>
          </view>
          <view class="spec-item">
            <text class="spec-label">æ‰¬ç¨‹:</text>
            <text class="spec-value">{{item.max_head}} m</text>
          </view>
          <view class="spec-item">
            <text class="spec-label">åŠŸç‡:</text>
            <text class="spec-value">{{item.rated_power}} kW</text>
          </view>
          <view class="spec-item">
            <text class="spec-label">æ•ˆç‡:</text>
            <text class="spec-value">{{item.efficiency}}%</text>
          </view>
        </view>

        <view class="result-match">
          <view class="match-item">
            <text class="match-label">æµé‡ä½™é‡:</text>
            <text class="match-value {{(item.max_flow_rate - selectionParams.required_flow_rate) / selectionParams.required_flow_rate >= 0.2 ? 'text-success' : 'text-warning'}}">
              {{((item.max_flow_rate - selectionParams.required_flow_rate) / selectionParams.required_flow_rate * 100).toFixed(1)}}%
            </text>
          </view>
          <view class="match-item">
            <text class="match-label">æ‰¬ç¨‹ä½™é‡:</text>
            <text class="match-value {{(item.max_head - selectionParams.required_head) / selectionParams.required_head >= 0.2 ? 'text-success' : 'text-warning'}}">
              {{((item.max_head - selectionParams.required_head) / selectionParams.required_head * 100).toFixed(1)}}%
            </text>
          </view>
        </view>

        <view class="result-footer">
          <text class="view-detail">æŸ¥çœ‹è¯¦æƒ… â€º</text>
        </view>
      </view>
    </view>

    <!-- ç©ºç»“æœ -->
    <view class="empty-results" wx:if="{{results.length === 0}}">
      <view class="empty-icon">ğŸ”</view>
      <view class="empty-title">æœªæ‰¾åˆ°åŒ¹é…äº§å“</view>
      <view class="empty-desc">è¯·å°è¯•è°ƒæ•´é€‰å‹å‚æ•°ï¼Œæˆ–è”ç³»æˆ‘ä»¬çš„æŠ€æœ¯å›¢é˜Ÿè·å–æ”¯æŒ</view>
    </view>

    <!-- é‡æ–°é€‰å‹ -->
    <view class="result-actions">
      <button class="btn btn-outline btn-block" bindtap="onReset">é‡æ–°é€‰å‹</button>
    </view>
  </view>
</scroll-view>
