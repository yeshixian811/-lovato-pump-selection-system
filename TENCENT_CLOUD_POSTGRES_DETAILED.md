# 🗄️ 腾讯云 PostgreSQL 详细配置指南

## 🚀 完整配置流程

---

## 📋 准备工作

### 需要的信息

- [ ] 腾讯云账号
- [ ] 服务器地址：122.51.22.101
- [ ] Vercel 项目：luowato-pump-selection-system

---

## 第 1 步：登录腾讯云 PostgreSQL 控制台

### 1.1 访问控制台

打开浏览器，访问：
```
https://console.cloud.tencent.com/postgres
```

### 1.2 登录腾讯云

使用你的腾讯云账号登录

---

## 第 2 步：创建 PostgreSQL 实例

### 2.1 点击"新建实例"

在 PostgreSQL 控制台页面，找到并点击 **新建实例** 按钮

### 2.2 配置实例

#### 基础配置

| 配置项 | 推荐值 | 说明 |
|--------|--------|------|
| **计费模式** | 按量计价 | 按需付费，灵活控制 |
| **地域** | 广州 | 选择与服务器相同的地域 |
| **可用区** | 广州三区 | 任选一个可用区 |
| **数据库引擎** | PostgreSQL | |
| **数据库版本** | 14 | 也可以选择 15 |
| **兼容性** | PostgreSQL | |

#### 规格配置

| 配置项 | 推荐值 | 说明 |
|--------|--------|------|
| **实例规格** | 2核4GB | 适合中小型应用 |
| **存储空间** | 100GB | 适合初始阶段 |

#### 网络配置

| 配置项 | 推荐值 | 说明 |
|--------|--------|------|
| **私有网络** | 默认 | 选择默认 VPC |
| **子网** | 默认 | 选择默认子网 |
| **安全组** | 默认 | 确保允许 5432 端口 |

#### 实例设置

| 配置项 | 推荐值 | 说明 |
|--------|--------|------|
| **实例名** | lovato-pump-db | 标识实例用途 |
| **访问模式** | 标准 | |
| **字符集** | UTF-8 | |
| **表空间** | 默认 | |

### 2.3 设置管理员密码

- **管理员账号**：root 或自定义
- **密码**：设置一个强密码（至少 8 位，包含字母、数字、特殊字符）

**重要：记住这个密码！**

### 2.4 确认订单

检查所有配置，点击 **立即购买** → **确认订单**

---

## 第 3 步：等待实例创建

### 创建过程

**预计时间：** 3-10 分钟

**创建状态：**
1. 🔄 资源初始化
2. 🔄 实例启动
3. 🔄 初始化配置
4. ✅ 创建完成

### 创建完成标志

在实例列表中，状态显示为 **运行中**

---

## 第 4 步：创建数据库

### 4.1 进入实例管理

1. 在实例列表中找到刚创建的实例
2. 点击实例名称进入管理页面

### 4.2 打开数据库管理

在左侧菜单中，找到并点击 **数据库管理**

### 4.3 创建数据库

点击 **创建数据库** 按钮

填写以下信息：

| 配置项 | 值 |
|--------|-----|
| **数据库名** | lovato_pump |
| **字符集** | UTF-8 |
| **Collate** | en_US.UTF-8 |
| **Ctype** | en_US.UTF-8 |
| **备注** | 洛瓦托水泵选型系统 |

点击 **确定**

---

## 第 5 步：创建数据库账号

### 5.1 打开账号管理

在左侧菜单中，找到并点击 **账号管理**

### 5.2 创建账号

点击 **创建账号** 按钮

填写以下信息：

| 配置项 | 值 |
|--------|-----|
| **账号名** | lovato_user |
| **主机** | % |
| **密码** | 设置一个强密码（记住！） |
| **备注** | 应用账号 |

**重要：**
- 主机选择 `%` 表示允许所有 IP 访问
- 记住这个密码！

### 5.3 设置权限

在权限设置中：

1. **选择数据库**：lovato_pump
2. **权限类型**：所有者（Owner）

点击 **确定**

---

## 第 6 步：获取连接信息

### 6.1 打开连接管理

1. 在实例详情页面
2. 点击 **连接管理** 标签

### 6.2 开启外网地址

如果外网地址未开启：

1. 点击 **开启外网**
2. 确认开启

### 6.3 查看连接信息

在连接信息中，找到以下内容：

| 项目 | 值（示例） |
|------|-----------|
| **内网地址** | 10.0.0.1 |
| **内网端口** | 5432 |
| **外网地址** | pg-xxx.tencentpg.com |
| **外网端口** | 5432 |

### 6.4 保存连接信息

**请记录以下信息（用实际值替换）：**

```
数据库类型：腾讯云 PostgreSQL
数据库：lovato_pump
用户名：lovato_user
密码：[你的密码]
外网地址：[实际外网地址]
端口：5432
```

### 6.5 生成连接字符串

**标准格式：**
```
postgresql://lovato_user:密码@外网地址:5432/lovato_pump
```

**示例：**
```
postgresql://lovato_user:mypassword123@pg-abc123.tencentpg.com:5432/lovato_pump
```

**重要：将示例中的 `mypassword123` 和 `pg-abc123.tencentpg.com` 替换为实际的值！**

---

## 第 7 步：配置安全组

### 7.1 打开安全组管理

1. 在实例详情页面
2. 点击 **安全组** 标签

### 7.2 配置规则

确保安全组规则中包含：

| 规则 | 协议 | 端口 | 来源 |
|------|------|------|------|
| 入站规则 | TCP | 5432 | 0.0.0.0/0 |

**注意：** 如果限制来源，需要添加 Vercel 的 IP 范围。为了简单起见，可以先允许所有 IP。

---

## 第 8 步：在 Vercel 中配置环境变量

### 8.1 访问 Vercel Dashboard

1. 打开浏览器，访问：https://vercel.com/dashboard
2. 登录 Vercel 账号

### 8.2 选择项目

在项目列表中，找到并点击：
```
luowato-pump-selection-system
```

### 8.3 打开环境变量设置

1. 在项目页面顶部，点击 **Settings** (设置)
2. 在左侧菜单中，点击 **Environment Variables** (环境变量)

### 8.4 添加 DATABASE_URL

1. 点击 **Add New** 按钮
2. 填写以下信息：

| 配置项 | 值 |
|--------|-----|
| **Name** | DATABASE_URL |
| **Value** | [第 6 步生成的连接字符串] |
| **Environment** | All |

**示例 Value：**
```
postgresql://lovato_user:mypassword123@pg-abc123.tencentpg.com:5432/lovato_pump
```

3. 点击 **Add**

### 8.5 保存配置

确认配置正确后，点击 **Save**

---

## 第 9 步：重新部署项目

### 9.1 进入部署页面

1. 在项目页面顶部，点击 **Deployments** 标签

### 9.2 触发重新部署

1. 点击右上角的 **Redeploy** 按钮
2. 选择 **Redeploy to Production**
3. 点击 **Redeploy**

### 9.3 等待部署完成

**预计时间：** 5-10 分钟

**部署状态：**
1. 🔄 Building（构建中）
2. 🔄 Deploying（部署中）
3. ✅ Ready（完成）

---

## 第 10 步：测试数据库连接

### 10.1 方法 1：通过网站测试

部署完成后，访问：
```
https://lowatopump.com
```

尝试使用需要数据库的功能（如登录），看是否正常。

### 10.2 方法 2：使用 psql

在本地电脑上（安装了 PostgreSQL）：

```bash
psql -h 外网地址 -p 5432 -U lovato_user -d lovato_pump
```

输入密码，如果连接成功，会看到：

```
psql (14.x)
Type "help" for help.

lovato_pump=#
```

### 10.3 方法 3：使用在线工具

使用 PostgreSQL 在线测试工具（如：
- https://www.psql.io
- https://www.sqltest.net）

---

## 📋 配置检查清单

### 腾讯云配置

- [ ] 创建 PostgreSQL 实例
- [ ] 等待实例创建完成
- [ ] 创建数据库 `lovato_pump`
- [ ] 创建账号 `lovato_user`
- [ ] 开启外网地址
- [ ] 配置安全组
- [ ] 获取外网地址和端口
- [ ] 生成连接字符串

### Vercel 配置

- [ ] 访问 Vercel Dashboard
- [ ] 选择项目 `luowato-pump-selection-system`
- [ ] 进入 Settings → Environment Variables
- [ ] 添加 `DATABASE_URL` 环境变量
- [ ] 保存配置
- [ ] 重新部署
- [ ] 等待部署完成

### 验证

- [ ] 部署状态显示 Ready
- [ ] 测试数据库连接
- [ ] 测试网站功能

---

## 🔗 连接信息记录表

请将实际信息填写到下面：

| 项目 | 实际值 |
|------|--------|
| **数据库类型** | 腾讯云 PostgreSQL |
| **实例名称** | lovato-pump-db |
| **数据库** | lovato_pump |
| **用户名** | lovato_user |
| **密码** | _________________ |
| **外网地址** | _________________ |
| **端口** | 5432 |
| **连接字符串** | postgresql://lovato_user:________@________:5432/lovato_pump |

---

## 💰 成本估算

### 按量计费

| 项目 | 价格 |
|------|------|
| **2核4GB 实例** | 约 ¥0.5-1/小时 |
| **100GB 存储** | 约 ¥0.3-0.5/GB/月 |
| **流量费** | 按实际使用 |

**月成本估算：**
- 实例：¥360-720/月
- 存储：¥30-50/月
- **总计：¥390-770/月**

### 包年包月

**优惠：** 按量计费的 60-70%

**月成本估算：¥235-470/月**

---

## 🔧 常见问题

### Q1：创建实例需要多长时间？

**A：** 通常 3-10 分钟，请耐心等待。

### Q2：如何查看实例是否创建成功？

**A：** 在实例列表中，状态显示为 **运行中** 即表示创建成功。

### Q3：如何测试数据库连接？

**A：** 使用 psql 命令：
```bash
psql -h 外网地址 -p 5432 -U lovato_user -d lovato_pump
```

### Q4：连接超时怎么办？

**A：**
1. 检查外网地址是否开启
2. 检查安全组是否允许 5432 端口
3. 确认连接字符串正确

### Q5：如何修改密码？

**A：**
1. 在腾讯云控制台中
2. 进入 **账号管理**
3. 点击账号右侧的 **修改密码**
4. 输入新密码

### Q6：数据库会自动备份吗？

**A：** 腾讯云 PostgreSQL 会自动备份，也可以手动创建备份。

---

## 🎯 下一步

配置完成后：

1. ✅ 数据库连接正常
2. ✅ 网站功能可用
3. ✅ 数据安全可靠
4. ✅ 自动备份保障

---

**按照以上步骤完成配置！** 🚀

**完成后告诉我连接信息，我帮你验证配置是否正确！** 👍
