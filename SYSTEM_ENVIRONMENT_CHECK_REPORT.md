# ğŸ” ç³»ç»Ÿç¯å¢ƒæ£€æŸ¥æŠ¥å‘Š

**æ£€æŸ¥æ—¶é—´**: 2025-01-14
**æ£€æŸ¥äºº**: ç³»ç»Ÿç®¡ç†å‘˜
**ç¯å¢ƒ**: Coze Coding æ²™ç®±ç¯å¢ƒ

---

## ğŸ“Š ç¯å¢ƒæ‘˜è¦

| é¡¹ç›® | çŠ¶æ€ | è¯¦æƒ… |
|------|------|------|
| æ“ä½œç³»ç»Ÿ | âœ… Ubuntu 24.04.3 LTS | Noble Numbat |
| Node.js | âœ… v24.13.0 | æœ€æ–°ç¨³å®šç‰ˆ |
| pnpm | âœ… 9.0.0 | ç¬¦åˆè¦æ±‚ |
| PostgreSQL | âŒ æœªå®‰è£… | éœ€è¦å®‰è£… |
| WebæœåŠ¡ | âœ… è¿è¡Œä¸­ | ç«¯å£ 5000 |
| é¡¹ç›®ç»“æ„ | âœ… å®Œæ•´ | æ‰€æœ‰æ–‡ä»¶å°±ç»ª |

---

## ğŸ–¥ï¸ æ“ä½œç³»ç»Ÿä¿¡æ¯

```
æ“ä½œç³»ç»Ÿ: Ubuntu 24.04.3 LTS (Noble Numbat)
ç³»ç»Ÿç±»å‹: Linux
æ¶æ„: æœªçŸ¥ (æœªæ£€æµ‹åˆ°systemctl)
```

### å­˜å‚¨ç©ºé—´

| æ–‡ä»¶ç³»ç»Ÿ | æ€»å¤§å° | å·²ç”¨ | å¯ç”¨ | ä½¿ç”¨ç‡ | æŒ‚è½½ç‚¹ |
|----------|--------|------|------|--------|--------|
| kataShared | 3.5T | 1.8T | 1.6T | 53% | / |
| /dev/vda | 9.8G | 24K | 9.8G | 1% | /tmp/user |
| s3fs (S3) | 16E | 0 | 16E | 0% | /space |

**å†…å­˜ä¿¡æ¯**:
- æ€»å†…å­˜: 7.9 GiB
- å·²ä½¿ç”¨: 3.1 GiB
- å¯ç”¨: 4.8 GiB
- äº¤æ¢åˆ†åŒº: 0 B

---

## ğŸ”§ å¼€å‘ç¯å¢ƒ

### Node.js & åŒ…ç®¡ç†å™¨

```bash
Node.js ç‰ˆæœ¬: v24.13.0 âœ…
pnpm ç‰ˆæœ¬: 9.0.0 âœ…
```

**çŠ¶æ€**: ç¬¦åˆé¡¹ç›®è¦æ±‚ï¼Œæ— éœ€å‡çº§

---

## ğŸ—„ï¸ æ•°æ®åº“çŠ¶æ€

### PostgreSQL

| æ£€æŸ¥é¡¹ | çŠ¶æ€ | ç»“æœ |
|--------|------|------|
| psql å‘½ä»¤ | âŒ | æœªæ‰¾åˆ° |
| pg_ctl å‘½ä»¤ | âŒ | æœªæ‰¾åˆ° |
| æœåŠ¡çŠ¶æ€ | âŒ | æœåŠ¡æœªå®‰è£… |
| åŒ…ç®¡ç†å™¨ | âŒ | æœªå®‰è£…PostgreSQLåŒ… |

**å½“å‰é…ç½®** (.env):
```
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/lovato_pump
POSTGRES_DATA_DIR=J:/postgresql/data
POSTGRES_BACKUP_DIR=J:/postgresql/backups
```

**é—®é¢˜**:
1. PostgreSQL æœªå®‰è£…
2. é…ç½®æŒ‡å‘ Windows è·¯å¾„ (J:/) - åœ¨ Linux ç¯å¢ƒä¸­æ— æ•ˆ

---

## ğŸŒ WebæœåŠ¡çŠ¶æ€

### æœåŠ¡æ£€æŸ¥

```bash
HTTP/1.1 200 OK
Vary: rsc, next-router-state-tree, next-router-prefetch, next-router-segment-prefetch, Accept-Encoding
```

**çŠ¶æ€**: âœ… WebæœåŠ¡è¿è¡Œæ­£å¸¸ (ç«¯å£ 5000)

### é¡¹ç›®ä¿¡æ¯

```
é¡¹ç›®åç§°: luowato-pump-selection (æ´›ç“¦æ‰˜æ°´æ³µé€‰å‹ç³»ç»Ÿ)
ç‰ˆæœ¬: 1.0.0
æ¡†æ¶: Next.js 16.1.1
React: 19.2.3
TypeScript: 5.x
```

### å·²å®‰è£…ä¾èµ–

âœ… æ ¸å¿ƒä¾èµ–å®Œæ•´:
- drizzle-orm (æ•°æ®åº“ORM)
- drizzle-kit (æ•°æ®åº“è¿ç§»å·¥å…·)
- pg / postgres (PostgreSQLå®¢æˆ·ç«¯)
- next-auth (èº«ä»½éªŒè¯)
- bcryptjs (å¯†ç åŠ å¯†)
- jose (JWTå¤„ç†)

âœ… UIç»„ä»¶å®Œæ•´:
- shadcn/ui (æ‰€æœ‰ç»„ä»¶)
- radix-ui (åŸºç¡€ç»„ä»¶åº“)
- lucide-react (å›¾æ ‡)

---

## ğŸ“ é¡¹ç›®ç»“æ„

### æ•°æ®åº“ç›¸å…³

```
âœ… migrations/001_add_membership_tables.sql - ä¼šå‘˜è¡¨è¿ç§»è„šæœ¬
âœ… src/storage/database/shared/schema.ts - æ•°æ®åº“Schemaå®šä¹‰
```

### éƒ¨ç½²è„šæœ¬

```
âœ… scripts/windows/ - Windowséƒ¨ç½²è„šæœ¬
   â”œâ”€â”€ migrate-to-j-drive-local.bat
   â”œâ”€â”€ quick-migrate.bat
   â”œâ”€â”€ verify-migration.bat
   â””â”€â”€ rollback-migration.bat
```

### æ–‡æ¡£

```
âœ… LOCAL_SERVER_DEPLOYMENT.md - æœ¬åœ°æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—
âœ… README-LOCAL-SERVER.md - å¿«é€Ÿå¼€å§‹æŒ‡å—
âœ… DATABASE_J_DRIVE.md - Jç›˜æ•°æ®åº“é…ç½®
âœ… DEPLOYMENT.md - é€šç”¨éƒ¨ç½²æŒ‡å—
```

---

## âš ï¸ å‘ç°çš„é—®é¢˜

### é—®é¢˜ 1: PostgreSQLæœªå®‰è£…

**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ é«˜

**å½±å“**:
- æ— æ³•è¿æ¥æ•°æ®åº“
- åº”ç”¨ç¨‹åºæ— æ³•ä½¿ç”¨æ•°æ®æŒä¹…åŒ–åŠŸèƒ½
- æ— æ³•è¿è¡Œæ•°æ®åº“è¿ç§»

**ä½ç½®**: ç³»ç»Ÿç¯å¢ƒ

**è¯¦æƒ…**:
- ç³»ç»Ÿä¸­æ²¡æœ‰å®‰è£…PostgreSQLæœåŠ¡
- æ‰€æœ‰PostgreSQLç›¸å…³å‘½ä»¤ä¸å¯ç”¨ (psql, pg_ctl)

---

### é—®é¢˜ 2: æ•°æ®åº“é…ç½®è·¯å¾„é”™è¯¯

**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¡ ä¸­

**å½±å“**:
- .env æ–‡ä»¶é…ç½®äº† Windows è·¯å¾„ (J:/)
- åœ¨ Linux ç¯å¢ƒä¸­æ— æ³•è¯†åˆ«

**ä½ç½®**: .env æ–‡ä»¶

**è¯¦æƒ…**:
```env
# å½“å‰é…ç½® (Windows)
POSTGRES_DATA_DIR=J:/postgresql/data
POSTGRES_BACKUP_DIR=J:/postgresql/backups

# åº”è¯¥æ”¹ä¸º (Linux)
POSTGRES_DATA_DIR=/var/lib/postgresql/data
POSTGRES_BACKUP_DIR=/var/lib/postgresql/backups
```

---

### é—®é¢˜ 3: ç¯å¢ƒä¸ä¸€è‡´

**ä¸¥é‡ç¨‹åº¦**: ğŸŸ¡ ä¸­

**å½±å“**:
- åˆ›å»ºçš„è„šæœ¬éƒ½æ˜¯ Windows æ‰¹å¤„ç†æ–‡ä»¶ (.bat)
- å½“å‰ç¯å¢ƒæ˜¯ Linuxï¼Œæ— æ³•ç›´æ¥æ‰§è¡Œ

**è¯¦æƒ…**:
- ç”¨æˆ·è¦æ±‚éƒ¨ç½²åˆ°æœ¬åœ° Windows æœåŠ¡å™¨
- å½“å‰åœ¨ Linux æ²™ç®±ç¯å¢ƒä¸­
- éœ€è¦æ˜ç¡®æ˜¯åœ¨å“ªä¸ªç¯å¢ƒä¸­éƒ¨ç½²

---

## âœ… ç¯å¢ƒä¼˜åŠ¿

### 1. å……è¶³çš„å­˜å‚¨ç©ºé—´
- 1.6T å¯ç”¨ç©ºé—´
- è¶³å¤Ÿå­˜å‚¨å¤§é‡æ•°æ®åº“å’Œåª’ä½“æ–‡ä»¶

### 2. ç°ä»£åŒ–çš„å¼€å‘ç¯å¢ƒ
- Ubuntu 24.04 LTS (æœ€æ–°LTS)
- Node.js v24 (æœ€æ–°ç¨³å®šç‰ˆ)
- å®Œæ•´çš„å¼€å‘å·¥å…·é“¾

### 3. å®Œæ•´çš„é¡¹ç›®ç»“æ„
- æ•°æ®åº“Schemaå·²å®šä¹‰
- è¿ç§»è„šæœ¬å·²å‡†å¤‡
- éƒ¨ç½²æ–‡æ¡£é½å…¨

### 4. WebæœåŠ¡è¿è¡Œæ­£å¸¸
- Next.js åº”ç”¨å·²å¯åŠ¨
- ç«¯å£5000å¯è®¿é—®
- çƒ­æ›´æ–°å¯ç”¨

---

## ğŸ”§ ä¿®å¤å»ºè®®

### é€‰é¡¹ A: åœ¨å½“å‰ Linux ç¯å¢ƒä¸­éƒ¨ç½² (æ¨èç”¨äºå¼€å‘/æµ‹è¯•)

å¦‚æœæ‚¨æƒ³åœ¨å½“å‰æ²™ç®±ç¯å¢ƒä¸­å¼€å‘å’Œæµ‹è¯•ï¼š

#### æ­¥éª¤ 1: å®‰è£… PostgreSQL

```bash
# æ›´æ–°åŒ…ç®¡ç†å™¨
sudo apt-get update

# å®‰è£… PostgreSQL
sudo apt-get install -y postgresql postgresql-contrib

# å¯åŠ¨æœåŠ¡
sudo service postgresql start

# è®¾ç½®postgresç”¨æˆ·å¯†ç 
sudo -u postgres psql -c "ALTER USER postgres WITH PASSWORD 'postgres';"

# åˆ›å»ºæ•°æ®åº“
sudo -u postgres createdb lovato_pump
```

#### æ­¥éª¤ 2: æ›´æ–° .env é…ç½®

```env
# å°† .env ä¸­çš„è·¯å¾„æ”¹ä¸º Linux è·¯å¾„
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/lovato_pump
POSTGRES_DATA_DIR=/var/lib/postgresql/14/main
POSTGRES_BACKUP_DIR=/var/lib/postgresql/backups
```

#### æ­¥éª¤ 3: è¿è¡Œæ•°æ®åº“è¿ç§»

```bash
# ä½¿ç”¨ Drizzle Kit ç”Ÿæˆå¹¶è¿è¡Œè¿ç§»
pnpm drizzle-kit generate
pnpm drizzle-kit migrate

# æˆ–æ‰‹åŠ¨æ‰§è¡ŒSQLè„šæœ¬
sudo -u postgres psql -d lovato_pump < migrations/001_add_membership_tables.sql
```

#### æ­¥éª¤ 4: é‡å¯åº”ç”¨

```bash
# åº”ç”¨ä¼šè‡ªåŠ¨é‡è¿æ•°æ®åº“
# æ— éœ€æ‰‹åŠ¨é‡å¯ (çƒ­æ›´æ–°)
```

---

### é€‰é¡¹ B: å‡†å¤‡åœ¨æœ¬åœ° Windows æœåŠ¡å™¨éƒ¨ç½² (ç”Ÿäº§ç¯å¢ƒ)

å¦‚æœæ‚¨æƒ³åœ¨æœ¬åœ° Windows æœåŠ¡å™¨ä¸Šéƒ¨ç½²ï¼š

#### æ­¥éª¤ 1: åœ¨ Windows æœåŠ¡å™¨ä¸Šå®‰è£… PostgreSQL

ä¸‹è½½å¹¶å®‰è£… PostgreSQL 14:
- https://www.postgresql.org/download/windows/

å®‰è£…è®¾ç½®:
- å¯†ç : postgres
- ç«¯å£: 5432
- æ•°æ®ç›®å½•: J:\postgresql\data

#### æ­¥éª¤ 2: å‡†å¤‡è¿ç§»

åœ¨ Windows æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹æ“ä½œ:

1. **å¤åˆ¶é¡¹ç›®æ–‡ä»¶**:
   - å°†æ•´ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹å¤åˆ¶åˆ° Windows æœåŠ¡å™¨
   - æˆ–ä½¿ç”¨ Git clone

2. **è¿è¡Œç¯å¢ƒæ£€æŸ¥**:
   ```batch
   systeminfo
   dir J:\
   sc query postgresql-x64-14
   ```

3. **æ‰§è¡Œè¿ç§»è„šæœ¬**:
   ```batch
   cd scripts\windows
   quick-migrate.bat
   ```

4. **éªŒè¯è¿ç§»**:
   ```batch
   verify-migration.bat
   ```

#### æ­¥éª¤ 3: æ›´æ–° .env é…ç½®

åœ¨ Windows æœåŠ¡å™¨çš„ .env æ–‡ä»¶ä¸­ä¿æŒ:

```env
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/lovato_pump
POSTGRES_DATA_DIR=J:\postgresql\data
POSTGRES_BACKUP_DIR=J:\postgresql\backups
```

#### æ­¥éª¤ 4: å¯åŠ¨åº”ç”¨

```batch
# å®‰è£…ä¾èµ–
pnpm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm run dev

# æˆ–å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
pnpm run build
pnpm run start
```

---

### é€‰é¡¹ C: ä½¿ç”¨å¤–éƒ¨æ•°æ®åº“æœåŠ¡ (SaaS)

å¦‚æœæ‚¨ä¸æƒ³æœ¬åœ°å®‰è£…æ•°æ®åº“ï¼Œå¯ä»¥ä½¿ç”¨äº‘æ•°æ®åº“:

#### æ¨èæ–¹æ¡ˆ

1. **Supabase** (å…è´¹é¢åº¦å……è¶³):
   - https://supabase.com
   - æä¾›PostgreSQL + API + è®¤è¯

2. **Neon** (Serverless PostgreSQL):
   - https://neon.tech
   - è‡ªåŠ¨æ‰©å±•ï¼ŒæŒ‰ä½¿ç”¨ä»˜è´¹

3. **Railway** (ç®€å•æ˜“ç”¨):
   - https://railway.app
   - ä¸€é”®éƒ¨ç½²

#### é…ç½®æ­¥éª¤

1. æ³¨å†Œè´¦å·å¹¶åˆ›å»ºæ•°æ®åº“
2. è·å–è¿æ¥å­—ç¬¦ä¸²
3. æ›´æ–° .env:

```env
DATABASE_URL=postgresql://user:password@host:port/database
```

4. è¿è¡Œè¿ç§»è„šæœ¬

---

## ğŸ“‹ éªŒè¯æ¸…å•

å®‰è£…æ•°æ®åº“åï¼Œè¯·éªŒè¯ä»¥ä¸‹é¡¹:

### åŸºç¡€éªŒè¯

- [ ] PostgreSQLæœåŠ¡è¿è¡Œæ­£å¸¸
- [ ] å¯ä»¥ä½¿ç”¨ psql è¿æ¥
- [ ] æ•°æ®åº“ lovato_pump å·²åˆ›å»º
- [ ] æ‰€æœ‰è¡¨å·²åˆ›å»º
- [ ] ç´¢å¼•å·²åˆ›å»º

### åŠŸèƒ½éªŒè¯

- [ ] åº”ç”¨ç¨‹åºå¯ä»¥è¿æ¥æ•°æ®åº“
- [ ] ç”¨æˆ·æ³¨å†Œ/ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®æŸ¥è¯¢æ­£å¸¸
- [ ] æ•°æ®å†™å…¥æ­£å¸¸
- [ ] ä¼šå‘˜åŠŸèƒ½æ­£å¸¸

### æ€§èƒ½éªŒè¯

- [ ] æŸ¥è¯¢å“åº”æ—¶é—´ < 100ms
- [ ] è¿æ¥æ± æ­£å¸¸å·¥ä½œ
- [ ] æ— å†…å­˜æ³„æ¼

---

## ğŸ¯ æ¨èæ–¹æ¡ˆ

æ ¹æ®å½“å‰ç¯å¢ƒå’Œéœ€æ±‚ï¼Œæˆ‘æ¨èä»¥ä¸‹æ–¹æ¡ˆ:

### å¦‚æœæ˜¯å¼€å‘/æµ‹è¯•:
**é€‰æ‹©é€‰é¡¹ A** - åœ¨å½“å‰ Linux ç¯å¢ƒä¸­å®‰è£… PostgreSQL

**ä¼˜ç‚¹**:
- å¿«é€Ÿå¼€å§‹ (5åˆ†é’Ÿ)
- æ— éœ€é¢å¤–ç¡¬ä»¶
- è‡ªåŠ¨é…ç½®
- ä¸å½“å‰ç¯å¢ƒä¸€è‡´

**ç¼ºç‚¹**:
- æ•°æ®ä»…åœ¨æ²™ç®±ä¸­
- é‡å¯ç¯å¢ƒåæ•°æ®ä¸¢å¤±

---

### å¦‚æœæ˜¯ç”Ÿäº§éƒ¨ç½²:
**é€‰æ‹©é€‰é¡¹ B** - åœ¨æœ¬åœ° Windows æœåŠ¡å™¨éƒ¨ç½²

**ä¼˜ç‚¹**:
- æ•°æ®æŒä¹…åŒ–
- å®Œå…¨æ§åˆ¶
- å¯ä»¥ä½¿ç”¨ J ç›˜å­˜å‚¨
- ç¬¦åˆç”¨æˆ·éœ€æ±‚

**ç¼ºç‚¹**:
- éœ€è¦é¢å¤–é…ç½® (20-30åˆ†é’Ÿ)
- éœ€è¦WindowsæœåŠ¡å™¨

---

### å¦‚æœæ˜¯å¿«é€ŸåŸå‹:
**é€‰æ‹©é€‰é¡¹ C** - ä½¿ç”¨å¤–éƒ¨äº‘æ•°æ®åº“

**ä¼˜ç‚¹**:
- é›¶é…ç½®
- è‡ªåŠ¨å¤‡ä»½
- é«˜å¯ç”¨æ€§
- å…è´¹é¢åº¦å……è¶³

**ç¼ºç‚¹**:
- éœ€è¦ç½‘ç»œè¿æ¥
- æ•°æ®ä¸åœ¨æœ¬åœ°
- é•¿æœŸå¯èƒ½éœ€è¦ä»˜è´¹

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

è¯·é€‰æ‹©ä¸€ä¸ªæ–¹æ¡ˆå¹¶å‘Šè¯‰æˆ‘ï¼Œæˆ‘å°†ä¸ºæ‚¨:

1. **é€‰é¡¹ A (å½“å‰ç¯å¢ƒ)**:
   - æä¾›å®Œæ•´çš„ PostgreSQL å®‰è£…è„šæœ¬
   - è‡ªåŠ¨é…ç½®æ•°æ®åº“
   - è¿è¡Œè¿ç§»è„šæœ¬

2. **é€‰é¡¹ B (WindowsæœåŠ¡å™¨)**:
   - ä¼˜åŒ– Windows éƒ¨ç½²è„šæœ¬
   - æä¾›è¯¦ç»†çš„æ‰‹åŠ¨æ­¥éª¤
   - åˆ›å»ºè‡ªåŠ¨åŒ–å®‰è£…ç¨‹åº

3. **é€‰é¡¹ C (äº‘æ•°æ®åº“)**:
   - å¸®åŠ©æ‚¨é€‰æ‹©æœåŠ¡å•†
   - é…ç½®è¿æ¥
   - éªŒè¯åŠŸèƒ½

---

## ğŸ“ æ€»ç»“

**ç¯å¢ƒçŠ¶æ€**: ğŸŸ¡ åŸºæœ¬å°±ç»ªï¼Œç¼ºå°‘æ•°æ®åº“

**ä¸»è¦é—®é¢˜**:
1. PostgreSQL æœªå®‰è£…
2. é…ç½®è·¯å¾„ä¸å½“å‰ç¯å¢ƒä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**: 3ä¸ªé€‰é¡¹å¯é€‰

**æ¨è**: æ ¹æ®ä½¿ç”¨åœºæ™¯é€‰æ‹©æ–¹æ¡ˆ

**é¢„è®¡æ—¶é—´**:
- é€‰é¡¹ A: 5-10åˆ†é’Ÿ
- é€‰é¡¹ B: 20-30åˆ†é’Ÿ
- é€‰é¡¹ C: 10-15åˆ†é’Ÿ

---

**è¯·å‘Šè¯‰æˆ‘æ‚¨æƒ³é€‰æ‹©å“ªä¸ªæ–¹æ¡ˆï¼Œæˆ‘å°†ç«‹å³ä¸ºæ‚¨æ‰§è¡Œï¼** ğŸš€
