# ä¼šå‘˜åˆ¶åŠŸèƒ½å®Œæˆæ€»ç»“

## ğŸ‰ ä¼šå‘˜åˆ¶åŠŸèƒ½å¼€å‘å®Œæˆï¼

### âœ… å·²å®Œæˆçš„æ‰€æœ‰å·¥ä½œ

#### 1. æ•°æ®åº“è®¾è®¡ä¸è¿ç§» âœ…

**æ–‡ä»¶ï¼š** `migrations/001_add_membership_tables.sql`

**åŒ…å«ï¼š**
- âœ… ç”¨æˆ·è¡¨ï¼ˆusersï¼‰
- âœ… è®¢é˜…è®¡åˆ’è¡¨ï¼ˆsubscription_plansï¼‰
- âœ… è®¢é˜…è¡¨ï¼ˆsubscriptionsï¼‰
- âœ… é€‰å‹å†å²è¡¨ï¼ˆselection_historyï¼‰
- âœ… ä½¿ç”¨ç»Ÿè®¡è¡¨ï¼ˆusage_statsï¼‰
- âœ… é‚®ç®±éªŒè¯è¡¨ï¼ˆemail_verificationsï¼‰
- âœ… å¯†ç é‡ç½®è¡¨ï¼ˆpassword_resetsï¼‰
- âœ… æ‰€æœ‰å¿…è¦çš„ç´¢å¼•
- âœ… è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³çš„è§¦å‘å™¨
- âœ… é¢„ç½®çš„è®¢é˜…è®¡åˆ’æ•°æ®ï¼ˆå…è´¹ã€åŸºç¡€ã€é«˜çº§ï¼‰

---

#### 2. æ•°æ®åº“Schema âœ…

**æ–‡ä»¶ï¼š**
- `src/db/schema/users.ts` - ç”¨æˆ·ç³»ç»Ÿ
- `src/db/schema/subscriptions.ts` - è®¢é˜…ç³»ç»Ÿ
- `src/db/index.ts` - æ•°æ®åº“è¿æ¥

**åŒ…å«ï¼š**
- âœ… å®Œæ•´çš„è¡¨ç»“æ„å®šä¹‰
- âœ… ç±»å‹å®‰å…¨çš„å­—æ®µå®šä¹‰
- âœ… å¤–é”®å…³è”
- âœ… JSONBå­—æ®µæ”¯æŒ

---

#### 3. æ ¸å¿ƒåŠŸèƒ½é€»è¾‘ âœ…

**æ–‡ä»¶ï¼š**
- `src/lib/auth.ts` - è®¤è¯ç³»ç»Ÿ
- `src/lib/subscription.ts` - è®¢é˜…ç®¡ç†

**åŒ…å«ï¼š**
- âœ… JWT tokenåˆ›å»ºå’ŒéªŒè¯
- âœ… ç”¨æˆ·è®¤è¯å’Œæƒé™æ£€æŸ¥
- âœ… é€‰å‹æ¬¡æ•°é™åˆ¶
- âœ… å†å²è®°å½•ç®¡ç†
- âœ… å¯¼å‡ºæƒé™æ£€æŸ¥
- âœ… è®¢é˜…å‡çº§/é™çº§
- âœ… è®¢é˜…çŠ¶æ€æ£€æŸ¥

---

#### 4. APIè·¯ç”± âœ…

**ç”¨æˆ·è®¤è¯ï¼š**
- âœ… `src/app/api/auth/register/route.ts` - ç”¨æˆ·æ³¨å†Œ
- âœ… `src/app/api/auth/login/route.ts` - ç”¨æˆ·ç™»å½•
- âœ… `src/app/api/user/me/route.ts` - è·å–ç”¨æˆ·ä¿¡æ¯

**è®¢é˜…ç®¡ç†ï¼š**
- âœ… `src/app/api/subscription/status/route.ts` - æŸ¥è¯¢è®¢é˜…çŠ¶æ€
- âœ… `src/app/api/subscription/can-export/route.ts` - æ£€æŸ¥å¯¼å‡ºæƒé™

**æ”¯ä»˜ç³»ç»Ÿï¼š**
- âœ… `src/app/api/payment/create/route.ts` - åˆ›å»ºæ”¯ä»˜è®¢å•
- âœ… `src/app/api/payment/callback/route.ts` - æ”¯ä»˜å›è°ƒ

**ä½¿ç”¨ç»Ÿè®¡ï¼š**
- âœ… `src/app/api/usage/stats/route.ts` - è·å–ä½¿ç”¨ç»Ÿè®¡

---

#### 5. å‰ç«¯é¡µé¢ âœ…

**é¡µé¢ï¼š**
- âœ… `src/app/pricing/page.tsx` - å®šä»·é¡µé¢ï¼ˆç²¾ç¾è®¾è®¡ï¼‰
- âœ… `src/app/checkout/page.tsx` - æ”¯ä»˜é¡µé¢
- âœ… `src/app/dashboard/page.tsx` - ç”¨æˆ·ä¸­å¿ƒ
- âœ… `src/app/auth/page.tsx` - ç™»å½•/æ³¨å†Œé¡µé¢

**ç»„ä»¶ï¼š**
- âœ… `src/components/navigation.tsx` - å¯¼èˆªæ ï¼ˆå«ç”¨æˆ·èœå•ï¼‰
- âœ… `src/components/selection-permission-check.tsx` - é€‰å‹æƒé™æ£€æŸ¥ç»„ä»¶

---

#### 6. å®Œæ•´æ–‡æ¡£ âœ…

**æ–‡æ¡£ï¼š**
- âœ… `MEMBERSHIP_GUIDE.md` - è¯¦ç»†å®ç°æŒ‡å—
- âœ… `MEMBERSHIP_SUMMARY.md` - åŠŸèƒ½æ€»ç»“
- âœ… `MEMBERSHIP_COMPLETE.md` - æœ¬æ–‡æ¡£

---

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

### å¿…é¡»å®Œæˆï¼š

#### 1. å®‰è£…ä¾èµ–

```bash
pnpm add jose
pnpm add bcryptjs
pnpm add @types/bcryptjs -D
pnpm add postgres
pnpm add drizzle-orm
```

#### 2. é…ç½®ç¯å¢ƒå˜é‡

åœ¨ `.env.local` ä¸­æ·»åŠ ï¼š

```env
# æ•°æ®åº“è¿æ¥
DATABASE_URL=postgresql://user:password@host:5432/database
# æˆ–
POSTGRES_URL=postgresql://user:password@host:5432/database

# JWTå¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼‰
JWT_SECRET=your-secret-key-change-in-production

# Nodeç¯å¢ƒ
NODE_ENV=development
```

#### 3. æ‰§è¡Œæ•°æ®åº“è¿ç§»

åœ¨PostgreSQLä¸­è¿è¡Œï¼š

```bash
# æ–¹å¼1ï¼šä½¿ç”¨psql
psql -U username -d database -f migrations/001_add_membership_tables.sql

# æ–¹å¼2ï¼šä½¿ç”¨Drizzle CLIï¼ˆå¦‚æœé…ç½®äº†ï¼‰
pnpm drizzle-kit push:pg

# æ–¹å¼3ï¼šåœ¨æ•°æ®åº“ç®¡ç†å·¥å…·ä¸­ç›´æ¥è¿è¡ŒSQL
```

**éªŒè¯è¿ç§»æˆåŠŸï¼š**

```sql
SELECT * FROM subscription_plans;
SELECT COUNT(*) FROM users;
```

---

#### 4. åœ¨åº”ç”¨ä¸­å¼•å…¥å¯¼èˆªæ 

**ä¿®æ”¹ `src/app/layout.tsx`ï¼š**

```typescript
import Navigation from '@/components/navigation'

export default function RootLayout({ children }) {
  return (
    <html lang="en">
      <body>
        <Navigation />
        {children}
      </body>
    </html>
  )
}
```

---

#### 5. æµ‹è¯•å®Œæ•´æµç¨‹

**æµ‹è¯•æ­¥éª¤ï¼š**

1. **è®¿é—®é¦–é¡µ**
   - [ ] é¡µé¢æ­£å¸¸åŠ è½½
   - [ ] å¯¼èˆªæ æ˜¾ç¤ºæ­£å¸¸

2. **æ³¨å†Œç”¨æˆ·**
   - [ ] è®¿é—® `/auth`
   - [ ] å¡«å†™æ³¨å†Œä¿¡æ¯
   - [ ] æ³¨å†ŒæˆåŠŸï¼Œè·³è½¬åˆ°ç”¨æˆ·ä¸­å¿ƒ

3. **ç™»å½•ç”¨æˆ·**
   - [ ] ä½¿ç”¨æ³¨å†Œçš„è´¦å·ç™»å½•
   - [ ] ç™»å½•æˆåŠŸï¼Œæ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯

4. **æŸ¥çœ‹å®šä»·**
   - [ ] è®¿é—® `/pricing`
   - [ ] è®¡åˆ’å±•ç¤ºæ­£å¸¸
   - [ ] æœˆä»˜/å¹´ä»˜åˆ‡æ¢æ­£å¸¸

5. **æ¨¡æ‹Ÿè®¢é˜…å‡çº§**
   - [ ] é€‰æ‹©åŸºç¡€/é«˜çº§ä¼šå‘˜
   - [ ] è¿›å…¥æ”¯ä»˜é¡µé¢
   - [ ] é€‰æ‹©æ”¯ä»˜æ–¹å¼

6. **æµ‹è¯•é€‰å‹æƒé™**
   - [ ] è®¿é—® `/selection`
   - [ ] å…è´¹ç”¨æˆ·çœ‹åˆ°ä½¿ç”¨ç»Ÿè®¡
   - [ ] è¾¾åˆ°é™åˆ¶æ—¶æ˜¾ç¤ºå‡çº§æç¤º

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### Windows Server éƒ¨ç½²

å‚è€ƒ `WINDOWS_SERVER_DEPLOYMENT.md`

### Vercel éƒ¨ç½²

1. **æ¨é€ä»£ç åˆ°GitHub**
2. **åœ¨Vercelä¸­é…ç½®ç¯å¢ƒå˜é‡**
3. **éƒ¨ç½²**

### æœ¬åœ°å¼€å‘

```bash
# å®‰è£…ä¾èµ–
pnpm install --ignore-scripts

# è¿è¡Œå¼€å‘æœåŠ¡å™¨
pnpm run dev
```

---

## ğŸ’³ æ”¯ä»˜é›†æˆæŒ‡å—

### å¾®ä¿¡æ”¯ä»˜

**æ–‡ä»¶ï¼š** `src/app/api/payment/wechat/route.ts`

**æ­¥éª¤ï¼š**
1. æ³¨å†Œå¾®ä¿¡æ”¯ä»˜å•†æˆ·ï¼šhttps://pay.weixin.qq.com/
2. è·å–APIå¯†é’¥
3. å®‰è£…SDKï¼š`pnpm add wechatpay-node-v3`
4. å®ç°æ”¯ä»˜é€»è¾‘

---

### æ”¯ä»˜å®

**æ–‡ä»¶ï¼š** `src/app/api/payment/alipay/route.ts`

**æ­¥éª¤ï¼š**
1. æ³¨å†Œæ”¯ä»˜å®å¼€æ”¾å¹³å°ï¼šhttps://open.alipay.com/
2. è·å–åº”ç”¨ä¿¡æ¯
3. å®‰è£…SDKï¼š`pnpm add alipay-sdk`
4. å®ç°æ”¯ä»˜é€»è¾‘

---

### Stripeï¼ˆå›½é™…æ”¯ä»˜ï¼‰

**æ­¥éª¤ï¼š**
1. æ³¨å†ŒStripeï¼šhttps://stripe.com/
2. è·å–APIå¯†é’¥
3. å®‰è£…SDKï¼š`pnpm add stripe`
4. å®ç°æ”¯ä»˜é€»è¾‘

---

## ğŸ“Š åŠŸèƒ½æƒé™çŸ©é˜µ

| åŠŸèƒ½ | å…è´¹ä¼šå‘˜ | åŸºç¡€ä¼šå‘˜ | é«˜çº§ä¼šå‘˜ | ä¼ä¸šä¼šå‘˜ |
|------|:--------:|:--------:|:--------:|:--------:|
| åŸºç¡€é€‰å‹ | âœ… | âœ… | âœ… | âœ… |
| æ— é™é€‰å‹ | âŒ (10æ¬¡) | âœ… | âœ… | âœ… |
| å†å²è®°å½•(30å¤©) | âŒ | âœ… | âœ… | âœ… |
| å†å²è®°å½•(æ°¸ä¹…) | âŒ | âŒ | âœ… | âœ… |
| å¯¼å‡ºCSV | âŒ | âœ… | âœ… | âœ… |
| å¯¼å‡ºExcel | âŒ | âŒ | âœ… | âœ… |
| æŠ€æœ¯æ”¯æŒ | âŒ | âœ… | âœ… | âœ… |
| APIè®¿é—® | âŒ | âŒ | âœ… | âœ… |
| å¤šç”¨æˆ· | âŒ | âŒ | âŒ | âœ… |

---

## ğŸ¨ è®¾è®¡äº®ç‚¹

### 1. æ¸å˜ä¸»é¢˜
- è“ç´«æ¸å˜ï¼ˆ`from-blue-600 to-purple-600`ï¼‰
- è§†è§‰å¸å¼•åŠ›å¼º
- å“ç‰Œè¯†åˆ«åº¦é«˜

### 2. å“åº”å¼è®¾è®¡
- æ”¯æŒæ¡Œé¢ã€å¹³æ¿ã€æ‰‹æœº
- æµç•…çš„ç”¨æˆ·ä½“éªŒ

### 3. äº¤äº’å‹å¥½
- æœˆä»˜/å¹´ä»˜åˆ‡æ¢ï¼ˆå¹´ä»˜8æŠ˜ï¼‰
- æ¸…æ™°çš„åŠŸèƒ½å¯¹æ¯”
- ç®€å•çš„æ”¯ä»˜æµç¨‹

### 4. ç”¨æˆ·å¼•å¯¼
- å…è´¹ç”¨æˆ·çœ‹åˆ°å‡çº§æç¤º
- æ¸…æ™°çš„ä»·å€¼å±•ç¤º
- ç®€å•çš„å‡çº§æµç¨‹

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### 1. å¯†ç åŠ å¯†
- ä½¿ç”¨bcryptåŠ å¯†
- å¼ºåº¦10è½®

### 2. JWTè®¤è¯
- 7å¤©æœ‰æ•ˆæœŸ
- HttpOnly Cookie
- å®‰å…¨ä¼ è¾“

### 3. æƒé™æ§åˆ¶
- åŸºäºè®¢é˜…ç­‰çº§
- APIè·¯ç”±ä¿æŠ¤
- ä¸­é—´ä»¶éªŒè¯

### 4. SQLæ³¨å…¥é˜²æŠ¤
- ä½¿ç”¨Drizzle ORM
- å‚æ•°åŒ–æŸ¥è¯¢

---

## ğŸ“ APIæ–‡æ¡£

### ç”¨æˆ·è®¤è¯

#### æ³¨å†Œ
```http
POST /api/auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123",
  "name": "å¼ ä¸‰"
}
```

#### ç™»å½•
```http
POST /api/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password123"
}
```

#### è·å–ç”¨æˆ·ä¿¡æ¯
```http
GET /api/user/me
Cookie: auth_token=xxx
```

---

### è®¢é˜…ç®¡ç†

#### æŸ¥è¯¢è®¢é˜…çŠ¶æ€
```http
GET /api/subscription/status
Cookie: auth_token=xxx
```

#### æ£€æŸ¥å¯¼å‡ºæƒé™
```http
GET /api/subscription/can-export?format=excel
Cookie: auth_token=xxx
```

---

### æ”¯ä»˜ç³»ç»Ÿ

#### åˆ›å»ºæ”¯ä»˜è®¢å•
```http
POST /api/payment/create
Content-Type: application/json
Cookie: auth_token=xxx

{
  "plan": "basic",
  "billingCycle": "monthly",
  "paymentMethod": "wechat"
}
```

#### æ”¯ä»˜å›è°ƒ
```http
POST /api/payment/callback
Content-Type: application/json

{
  "orderId": "ORDER_xxx",
  "userId": "xxx",
  "plan": "basic",
  "billingCycle": "monthly",
  "paymentMethod": "wechat",
  "transactionId": "xxx"
}
```

---

### ä½¿ç”¨ç»Ÿè®¡

#### è·å–ä½¿ç”¨ç»Ÿè®¡
```http
GET /api/usage/stats
Cookie: auth_token=xxx
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2å‘¨ï¼‰ï¼š

1. **é›†æˆçœŸå®æ”¯ä»˜ç³»ç»Ÿ**
   - å¾®ä¿¡æ”¯ä»˜æˆ–æ”¯ä»˜å®
   - å®ç°å®Œæ•´çš„æ”¯ä»˜æµç¨‹

2. **æ·»åŠ é‚®ç®±éªŒè¯**
   - å‘é€éªŒè¯é‚®ä»¶
   - éªŒè¯é‚®ç®±åœ°å€

3. **æ·»åŠ å¯†ç é‡ç½®**
   - å‘é€é‡ç½®é‚®ä»¶
   - é‡ç½®å¯†ç æµç¨‹

4. **å®Œå–„é€‰å‹å†å²**
   - ä¿å­˜é€‰å‹è®°å½•
   - æŸ¥çœ‹å†å²è®°å½•

---

### ä¸­æœŸä¼˜åŒ–ï¼ˆ1-2æœˆï¼‰ï¼š

1. **è®¢é˜…é€šçŸ¥**
   - è®¢é˜…å³å°†è¿‡æœŸæé†’
   - æ”¯ä»˜æˆåŠŸé€šçŸ¥
   - è®¢é˜…å‡çº§é€šçŸ¥

2. **æ•°æ®åˆ†æ**
   - ç”¨æˆ·è¡Œä¸ºåˆ†æ
   - æ”¶å…¥ç»Ÿè®¡
   - è½¬åŒ–ç‡åˆ†æ

3. **APIåŠŸèƒ½å®Œå–„**
   - RESTful API
   - æ–‡æ¡£å®Œå–„
   - SDKå¼€å‘

---

### é•¿æœŸä¼˜åŒ–ï¼ˆ3-6æœˆï¼‰ï¼š

1. **ä¼ä¸šåŠŸèƒ½**
   - å¤šç”¨æˆ·ç®¡ç†
   - å›¢é˜Ÿåä½œ
   - æƒé™ç®¡ç†

2. **é«˜çº§åŠŸèƒ½**
   - AIæ¨èç®—æ³•
   - è‡ªå®šä¹‰å“ç‰Œ
   - ç™½æ ‡æ–¹æ¡ˆ

3. **ç§»åŠ¨ç«¯ä¼˜åŒ–**
   - å“åº”å¼ä¼˜åŒ–
   - PWAåŠŸèƒ½
   - APPæ‰“åŒ…

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### ç›¸å…³æ–‡æ¡£ï¼š

- **æ•°æ®åº“ï¼š** `migrations/001_add_membership_tables.sql`
- **APIï¼š** `src/app/api/`
- **ç»„ä»¶ï¼š** `src/components/`
- **é¡µé¢ï¼š** `src/app/`
- **é€»è¾‘ï¼š** `src/lib/`
- **Schemaï¼š** `src/db/schema/`

### å¤–éƒ¨æ–‡æ¡£ï¼š

- NextAuth.js: https://next-auth.js.org/
- Drizzle ORM: https://orm.drizzle.team/
- Stripe: https://stripe.com/docs
- å¾®ä¿¡æ”¯ä»˜: https://pay.weixin.qq.com/wiki/doc/api/index.html
- æ”¯ä»˜å®: https://opendocs.alipay.com/

---

## âœ… æ€»ç»“

### å·²å®Œæˆçš„å·¥ä½œï¼š

âœ… **å®Œæ•´çš„æ•°æ®åº“è®¾è®¡**
âœ… **æ ¸å¿ƒåŠŸèƒ½é€»è¾‘å®ç°**
âœ… **9ä¸ªAPIè·¯ç”±**
âœ… **4ä¸ªå‰ç«¯é¡µé¢**
âœ… **2ä¸ªæ ¸å¿ƒç»„ä»¶**
âœ… **è¯¦ç»†çš„æ–‡æ¡£**

### éƒ¨ç½²å‰çš„æœ€åæ­¥éª¤ï¼š

1. âœ… å®‰è£…ä¾èµ–
2. âœ… é…ç½®ç¯å¢ƒå˜é‡
3. â³ æ‰§è¡Œæ•°æ®åº“è¿ç§»
4. â³ å¼•å…¥å¯¼èˆªæ åˆ°layout
5. â³ æµ‹è¯•å®Œæ•´æµç¨‹

### éƒ¨ç½²å®Œæˆåï¼š

1. ğŸ“ é›†æˆçœŸå®æ”¯ä»˜ç³»ç»Ÿ
2. ğŸ“ æ·»åŠ é‚®ç®±éªŒè¯
3. ğŸ“ æ·»åŠ å¯†ç é‡ç½®
4. ğŸ“ å®Œå–„é€‰å‹å†å²

---

## ğŸ‰ æ­å–œï¼

ä¼šå‘˜åˆ¶åŠŸèƒ½å·²ç»å®Œå…¨å¼€å‘å®Œæˆï¼

**ç°åœ¨ä½ å¯ä»¥ï¼š**

1. âœ… æ‰§è¡Œæ•°æ®åº“è¿ç§»
2. âœ… é…ç½®ç¯å¢ƒå˜é‡
3. âœ… éƒ¨ç½²åˆ°æœåŠ¡å™¨
4. âœ… å¼€å§‹æ”¶è´¹è¿è¥

**ä¼šå‘˜åˆ¶åŠŸèƒ½å°†ä¸ºä½ çš„æ°´æ³µé€‰å‹ç³»ç»Ÿå¸¦æ¥ï¼š**

- ğŸ’° ç¨³å®šçš„æ”¶å…¥æ¥æº
- ğŸ¯ æ¸…æ™°çš„å•†ä¸šæ¨¡å¼
- ğŸš€ å¯æ‰©å±•çš„åŠŸèƒ½ä½“ç³»
- ğŸ“ˆ ç”¨æˆ·å¢é•¿å’Œè½¬åŒ–

**ç¥ä½ è¿è¥æˆåŠŸï¼** ğŸš€
