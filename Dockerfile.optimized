# é˜¿é‡Œäº‘éƒ¨ç½²è¶…æ—¶é—®é¢˜è§£å†³æ–¹æ¡ˆ

## ğŸ” é”™è¯¯åˆ†æ

### é”™è¯¯ä¿¡æ¯
```
2026-02-10T18:16:24+08:00 error: [build] [runtime] BuildFaasRuntimePkg timeout
```

### é—®é¢˜åŸå› 
- **æ„å»ºè¶…æ—¶**ï¼šæ„å»ºè¿‡ç¨‹è¿è¡Œäº† **20 åˆ†é’Ÿ**åè¢«ç»ˆæ­¢
- å¯èƒ½åŸå› ï¼š
  1. é¡¹ç›®ä¾èµ–å¤ªå¤šï¼Œå®‰è£…æ—¶é—´è¿‡é•¿
  2. node_modules ä½“ç§¯è¿‡å¤§
  3. æ„å»ºè¿‡ç¨‹å¡ä½
  4. ç½‘ç»œé—®é¢˜å¯¼è‡´ä¸‹è½½ä¾èµ–æ…¢

---

## ğŸ”§ è§£å†³æ–¹æ¡ˆï¼ˆæŒ‰æ¨èé¡ºåºï¼‰

### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨æ‰‹åŠ¨éƒ¨ç½²ï¼ˆå¼ºçƒˆæ¨èï¼‰â­â­â­

é˜¿é‡Œäº‘è‡ªåŠ¨åŒ–éƒ¨ç½²å¹³å°ä¸é€‚åˆè¿™ä¸ªé¡¹ç›®çš„å¤§å°ã€‚ä½¿ç”¨æ‰‹åŠ¨éƒ¨ç½²å®Œå…¨å¯æ§ã€‚

**è¯¦ç»†æ­¥éª¤ï¼š** æŸ¥çœ‹ `MANUAL_DEPLOYMENT.md`

**å¿«é€Ÿå¼€å§‹ï¼š**

1. **è¿æ¥åˆ°æœåŠ¡å™¨**
   ```cmd
   ssh root@47.110.127.87
   ```

2. **æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ‰§è¡Œï¼š**
   ```bash
   # æ›´æ–°ç³»ç»Ÿ
   apt update

   # å®‰è£… Node.js 24
   curl -fsSL https://deb.nodesource.com/setup_24.x | bash -
   apt install -y nodejs git nginx

   # å®‰è£… pnpm
   npm install -g pnpm

   # å®‰è£… PM2
   npm install -g pm2

   # åˆ›å»ºé¡¹ç›®ç›®å½•
   mkdir -p /var/www/luowato-selection
   cd /var/www/luowato-selection

   # ä¸Šä¼ é¡¹ç›®æ–‡ä»¶ï¼ˆåœ¨ä½ çš„æœ¬åœ°ç”µè„‘æ‰§è¡Œï¼‰
   # scp "C:\Users\ASUS\Downloads\pack_project (3).tar.gz" root@47.110.127.87:/tmp/

   # åœ¨æœåŠ¡å™¨ä¸Šè§£å‹
   tar -xzf /tmp/pack_project\ \(3\).tar.gz -C /var/www/luowato-selection

   # å®‰è£…ä¾èµ–
   pnpm install

   # æ„å»ºé¡¹ç›®
   pnpm run build

   # é…ç½®ç¯å¢ƒå˜é‡
   cat > .env.production << EOF
   DATABASE_URL=postgresql://ç”¨æˆ·å:å¯†ç @å†…ç½‘åœ°å€:1921/æ•°æ®åº“å
   NEXT_PUBLIC_WECHAT_APP_ID=ä½ çš„å¾®ä¿¡AppID
   NODE_ENV=production
   PORT=5000
   NEXT_PUBLIC_APP_URL=https://lowato-pumps.com
   EOF

   # å¯åŠ¨åº”ç”¨
   pm2 start .next/standalone/server.js --name luowato-selection

   # é…ç½® Nginx
   cat > /etc/nginx/sites-available/luowato-selection << EOF
   server {
       listen 80;
       server_name lowato-pumps.com;
       location / {
           proxy_pass http://localhost:5000;
           proxy_http_version 1.1;
           proxy_set_header Upgrade \$http_upgrade;
           proxy_set_header Connection 'upgrade';
           proxy_set_header Host \$host;
           proxy_cache_bypass \$http_upgrade;
       }
   }
   EOF

   ln -sf /etc/nginx/sites-available/luowato-selection /etc/nginx/sites-enabled/
   nginx -t
   systemctl restart nginx
   ```

**ä¼˜åŠ¿ï¼š**
- âœ… å®Œå…¨å¯æ§ï¼Œå¯ä»¥çœ‹åˆ°è¯¦ç»†é”™è¯¯
- âœ… ä¸å—å¹³å°é™åˆ¶
- âœ… é€‚åˆç”Ÿäº§ç¯å¢ƒ
- âœ… æ„å»ºæ—¶é—´å¯æ§

---

### æ–¹æ¡ˆ 2ï¼šä¼˜åŒ–é¡¹ç›®é…ç½®ï¼ˆå¦‚æœå¿…é¡»ä½¿ç”¨è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼‰

æˆ‘å·²ç»åœ¨ `next.config.ts` ä¸­æ·»åŠ äº†æ„å»ºä¼˜åŒ–ï¼š

```typescript
const nextConfig: NextConfig = {
  output: 'standalone', // å¯ç”¨ç‹¬ç«‹è¾“å‡º
  experimental: {
    optimizePackageImports: ['recharts', 'lucide-react'],
  },
  // ... å…¶ä»–é…ç½®
};
```

**ä¼˜åŒ–æ•ˆæœï¼š**
- âœ… å‡å°‘ä¾èµ–æ‰“åŒ…ä½“ç§¯
- âœ… ä¼˜åŒ–åŒ…å¯¼å…¥
- âœ… åŠ å¿«æ„å»ºé€Ÿåº¦

---

### æ–¹æ¡ˆ 3ï¼šå‡å°‘é¡¹ç›®ä¾èµ–

æ£€æŸ¥å¹¶ç§»é™¤ä¸å¿…è¦çš„ä¾èµ–ï¼š

```bash
# æŸ¥çœ‹ä¾èµ–å¤§å°
pnpm list --depth=0

# æŸ¥çœ‹ä¾èµ–åˆ†æ
pnpm build -- --analyze
```

å»ºè®®ç§»é™¤ï¼š
- æœªä½¿ç”¨çš„åŒ…
- å¯ä»¥ç”¨ CDN ä»£æ›¿çš„åŒ…
- å¼€å‘ç¯å¢ƒä¸“ç”¨çš„åŒ…

---

### æ–¹æ¡ˆ 4ï¼šä½¿ç”¨ Docker éƒ¨ç½²

åˆ›å»ºä¼˜åŒ–çš„ Dockerfileï¼š<tool_call>write_file<arg_key>content</arg_key><arg_value># å¤šé˜¶æ®µæ„å»º - ä¼˜åŒ–æ„å»ºæ—¶é—´å’Œé•œåƒå¤§å°
FROM node:24-alpine AS builder

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®‰è£… pnpm
RUN npm install -g pnpm

# å¤åˆ¶ package æ–‡ä»¶
COPY package.json pnpm-lock.yaml ./

# å®‰è£…ä¾èµ–ï¼ˆä½¿ç”¨ --prefer-offline ç¼“å­˜ï¼‰
RUN pnpm install --frozen-lockfile --prefer-offline

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY . .

# æ„å»ºé¡¹ç›®
RUN pnpm run build

# ç”Ÿäº§é•œåƒ
FROM node:24-alpine AS runner

WORKDIR /app

# å®‰è£… pnpm
RUN npm install -g pnpm

# å¤åˆ¶å¿…è¦æ–‡ä»¶
COPY --from=builder /app/package.json ./
COPY --from=builder /app/pnpm-lock.yaml ./
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static
COPY --from=builder /app/public ./public

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV NODE_ENV=production
ENV PORT=5000

# æš´éœ²ç«¯å£
EXPOSE 5000

# å¯åŠ¨åº”ç”¨
CMD ["node", "server.js"]
